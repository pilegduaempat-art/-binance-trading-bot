.PHONY: help install run test clean docker-build docker-run deploy

# Default target
help:
	@echo "Binance Trading Bot - Available Commands"
	@echo ""
	@echo "  make install       - Install dependencies"
	@echo "  make run          - Run the application"
	@echo "  make test         - Run tests"
	@echo "  make clean        - Clean cache and temp files"
	@echo "  make docker-build - Build Docker image"
	@echo "  make docker-run   - Run Docker container"
	@echo "  make deploy       - Deploy to Streamlit Cloud"
	@echo ""

# Install dependencies
install:
	@echo "ðŸ“¦ Installing dependencies..."
	pip install --upgrade pip
	pip install -r requirements.txt
	@echo "âœ… Dependencies installed"

# Run the application
run:
	@echo "ðŸš€ Starting Binance Trading Bot..."
	streamlit run app.py

# Run tests (placeholder - add tests later)
test:
	@echo "ðŸ§ª Running tests..."
	@echo "âš ï¸  No tests configured yet"

# Clean cache and temporary files
clean:
	@echo "ðŸ§¹ Cleaning cache and temporary files..."
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete 2>/dev/null || true
	find . -type f -name "*.pyo" -delete 2>/dev/null || true
	find . -type d -name "*.egg-info" -exec rm -rf {} + 2>/dev/null || true
	rm -rf .streamlit/cache 2>/dev/null || true
	rm -rf build dist 2>/dev/null || true
	@echo "âœ… Cleaned"

# Build Docker image
docker-build:
	@echo "ðŸ³ Building Docker image..."
	docker build -t binance-trading-bot:latest .
	@echo "âœ… Docker image built"

# Run Docker container
docker-run:
	@echo "ðŸ³ Running Docker container..."
	docker-compose up -d
	@echo "âœ… Container started at http://localhost:8501"

# Stop Docker container
docker-stop:
	@echo "ðŸ›‘ Stopping Docker container..."
	docker-compose down
	@echo "âœ… Container stopped"

# Deploy to Streamlit Cloud
deploy:
	@echo "â˜ï¸  Deploying to Streamlit Cloud..."
	@echo "Please ensure you have:"
	@echo "  1. Pushed code to GitHub"
	@echo "  2. Connected repository to Streamlit Cloud"
	@echo "  3. Set main file to app.py"
	@echo ""
	@echo "Visit: https://share.streamlit.io"

# Create virtual environment
venv:
	@echo "ðŸ“¦ Creating virtual environment..."
	python3 -m venv venv
	@echo "âœ… Virtual environment created"
	@echo "Activate with: source venv/bin/activate (Linux/Mac) or venv\\Scripts\\activate (Windows)"

# Format code (requires black)
format:
	@echo "ðŸŽ¨ Formatting code..."
	pip install black
	black *.py tabs/*.py
	@echo "âœ… Code formatted"

# Lint code (requires pylint)
lint:
	@echo "ðŸ” Linting code..."
	pip install pylint
	pylint *.py tabs/*.py
	@echo "âœ… Lint complete"

# Check for security issues (requires bandit)
security:
	@echo "ðŸ”’ Checking for security issues..."
	pip install bandit
	bandit -r . -f json -o security-report.json
	@echo "âœ… Security check complete (see security-report.json)"

# Update dependencies
update:
	@echo "ðŸ”„ Updating dependencies..."
	pip install --upgrade pip
	pip install --upgrade -r requirements.txt
	@echo "âœ… Dependencies updated"

# Create requirements.txt from current environment
freeze:
	@echo "â„ï¸  Freezing dependencies..."
	pip freeze > requirements.txt
	@echo "âœ… requirements.txt updated"

# Show package versions
versions:
	@echo "ðŸ“‹ Installed package versions:"
	@pip list | grep -E "streamlit|ccxt|pandas|numpy|plotly|ta|scikit-learn"
